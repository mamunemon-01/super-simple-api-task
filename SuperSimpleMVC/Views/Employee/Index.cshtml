@{
    ViewData["Title"] = "Employee Management";
}

<h2>Employee Management</h2>

<div class="row">
    <div class="col-md-4">
        <h3>Add Employee</h3>
        <form id="addEmployeeForm">
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" required>
            </div>
            <div class="form-group">
                <label for="phoneNumber">Phone Number:</label>
                <input type="tel" class="form-control" id="phoneNumber" required>
            </div>
            <div class="form-group">
                <label for="department">Department:</label>
                <input type="text" class="form-control" id="department" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Employee</button>
        </form>
    </div>
    <div class="col-md-8">
        <h3>Employee List</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone Number</th>
                    <th>Department</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="employeeList"></tbody>
        </table>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-4">
        <h3>Search Employee</h3>
        <div class="form-group">
            <label for="searchType">Search By:</label>
            <select class="form-control" id="searchType">
                <option value="name">Name</option>
                <option value="phoneNumber">Phone Number</option>
                <option value="department">Department</option>
            </select>
        </div>
        <div class="form-group">
            <label for="searchTerm">Search Term:</label>
            <input type="text" class="form-control" id="searchTerm">
        </div>
        <button onclick="searchEmployees()" class="btn btn-primary">Search</button>
    </div>
</div>

@section Scripts{
    <script>
        const apiBaseUrl = "http://localhost:5299/api";

        function getAllEmployees(){
            $ajax({
                url:`${apiBaseUrl}/Employee/Retrieve`,
                method: 'GET',
                success: function(data){
                    updateEmployeeList(data);
                },
                error: function(error){
                    console.error('Error fetching employees: ', error);
                }
            });
        }

        function addEmployee(employee){
            $ajax({
                url: `${apiBaseUrl}/Employee/Create`,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(employee),
                success: function(data){
                    getAllEmployees();
                    $('#addEmployeeForm')[0]reset();
                },
                error: function(error){
                    console.error("Error adding employee: ", error);
                }
            });
        }

        function updateEmployee(id, employee){
            $ajax({
                url: `${apiBaseUrl}/Employee/Update/${id}`,
                method: 'PUT',
                connectionType: 'application/json',
                data: JSON.stringify(employee),
                success: function(data){
                    getAllEmployees();
                },
                error: function(error){
                    console.error('Error updating employee: ', error);
                }
            });
        }

        function deleteEmployee(id){
            $ajax({
                url: `${apiBaseUrl}/Employee/Delete/${id}`,
                method: 'DELETE',
                success: function(data){
                    getAllEmployees();
                },
                error: function(error){
                    console.error('Error deleting employee: ', error);
                }
            });
        }

        function searchEmployees(){
            const searchType = $('#searchType').val();
            const searchTerm = $('#searchTerm').val();
            let url;

            switch(searchType){
                case 'name':
                    url = `${apiBaseUrl}/Employee/Search/name/${searchTerm};`
                    break;
                case 'phoneNumber':
                    url = `${apiBaseUrl}/Employee/Search/phoneNo/${searchTerm}`;
                    break;
                case 'department':
                    url = `${apiBaseUrl}/Employee/Search/department/${searchTerm}`;
                    break;
            }

            $ajax({
                url: url,
                method: 'GET',
                success: function(data){
                    updateEmployeeList(data);
                },
                error: function(error){
                    console.error('Error searching employee: ', error);
                }
            });
        }

        function updateEmployeeList(employees){
            const employeeList = $('#employeeList');
            employeeList.empty();

            employees.foreach(employee => {
                employeeList.append(`
                    <tr>
                        <td>${employee.Name}</td>
                        <td>${employee.PhoneNo}</td>
                        <td>${employee.DeptName}</td>
                        <td>
                            <button onclick="updateEmployee(${employee.Id}, ${JSON.stringify(employee)})" class="btn btn-sm btn-primary">Edit</button>
                            <button onclick="deleteEmployee(${employee.Id})" class="btn btn-sm btn-danger">Delete</button>
                        </td>
                    </tr>
                `);
            });
        }

        $document.ready(function(){
            getAllEmployees();


            $('#addEmployeeForm').submit(function(e){
                e.preventDefault();
                const employee = {
                    name: $('#name').val(),
                    phoneNo: $('#phoneNo').val(),
                    deptName: $('#department').val();
                };
                addEmployee(employee);
            });
        });
    </script>
}